import{j as e}from"./ui-vendor-DeL-jnW0.js";import{h as F,r as u,u as M}from"./react-vendor-BRxAXmoz.js";import{A as D,i as K}from"./index-DDGz3ZKc.js";import{l as O}from"./socket-vendor-TjCxX7sJ.js";import{C as x,d as p,B as A,j as P,k as l,l as d,m as L,T as Y,e as i,s as $,c as Q}from"./antd-vendor-DXVleyxb.js";const U="https://minor-quiz-board-backend-nyphhuy7l-prakhars-projects-415595c3.vercel.app",c=O(U,{reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,timeout:1e4,transports:["websocket","polling"],withCredentials:!0,path:"/socket.io/"});c.on("connect",()=>{console.log("Socket connected successfully")});c.on("connect_error",n=>{console.error("Socket connection error:",n)});const{Title:C}=Y,G=({code:n,live:o,isCreator:E})=>{var y,S,v,k,z,w;const{code:H}=F(),h=n||H,[a,R]=u.useState({quiz:{},leaderboard:[],submissionHistory:[],metadata:{}}),[m,B]=u.useState(!0),[g,b]=u.useState(null),j=M(),{auth:_}=u.useContext(D);u.useEffect(()=>{const t=async()=>{var q,T,I,N;try{const s=await K.get(`/api/quiz/leaderboard/${h}${o?"?live=true":""}`);if(s.data.success)R({quiz:s.data.quiz,leaderboard:s.data.leaderboard,submissionHistory:s.data.submissionHistory,metadata:s.data.metadata}),b(null);else throw new Error(s.data.error||"Failed to fetch leaderboard")}catch(s){console.error("Error fetching leaderboard:",s),b(((T=(q=s.response)==null?void 0:q.data)==null?void 0:T.error)||"Failed to fetch leaderboard"),$.error(((N=(I=s.response)==null?void 0:I.data)==null?void 0:N.error)||"Failed to fetch leaderboard")}finally{B(!1)}};t();let r;return o&&(r=setInterval(t,3e3),c.on("player-submitted",()=>{t()}),c.on("answer-result",()=>{t()})),()=>{r&&clearInterval(r),o&&(c.off("player-submitted"),c.off("answer-result"))}},[h,o]);const f=[{title:"Rank",dataIndex:"rank",key:"rank",width:"15%",render:t=>e.jsxs(i,{color:t===1?"gold":t===2?"silver":t===3?"bronze":"default",children:["#",t]})},{title:"Player",dataIndex:"username",key:"username",width:"35%",render:(t,r)=>e.jsxs(Q,{children:[t,r.userId===_.userId&&e.jsx(i,{color:"green",children:"You"})]})},{title:"Score",dataIndex:"score",key:"score",width:"25%",render:t=>e.jsxs(i,{color:"blue",children:[t," points"]})},{title:o?"Status":"Percentage",dataIndex:o?"status":"percentage",key:o?"status":"percentage",width:"25%",render:(t,r)=>o?e.jsx(i,{color:r.submitted?"green":"orange",children:r.submitted?"Submitted":"Answering..."}):e.jsxs(i,{color:t>=70?"green":t>=40?"orange":"red",children:[t,"%"]})}];return m?e.jsx("div",{className:n?"":"auth-container",children:e.jsx(x,{loading:!0,className:n?"":"auth-card",children:"Loading..."})}):g?e.jsx("div",{className:n?"":"auth-container",children:e.jsx(x,{className:n?"":"auth-card",children:e.jsx(p,{status:"error",title:"Failed to load leaderboard",subTitle:g,extra:[e.jsx(A,{type:"primary",onClick:()=>j("/home"),children:"Back to Home"},"home")]})})}):n?e.jsxs("div",{className:"live-leaderboard",children:[e.jsxs(P,{gutter:16,style:{marginBottom:24},children:[e.jsx(l,{span:8,children:e.jsx(d,{title:"Average Score",value:Math.round(a.metadata.averageScore*10)/10||0,suffix:"points"})}),e.jsx(l,{span:8,children:e.jsx(d,{title:"Highest Score",value:a.metadata.highestScore||0,suffix:"points",valueStyle:{color:"#3f8600"}})}),e.jsx(l,{span:8,children:e.jsx(d,{title:"Total Participants",value:((y=a.leaderboard)==null?void 0:y.length)||0})})]}),((S=a.leaderboard)==null?void 0:S.length)>0?e.jsx(L,{dataSource:a.leaderboard.map((t,r)=>({...t,rank:r+1,key:t.userId})),columns:f,pagination:!1,loading:m,rowKey:"userId",className:"leaderboard-table"}):e.jsx(p,{status:"info",title:"No Results Yet",subTitle:"The leaderboard is currently empty. Please wait for participants to submit answers."}),E&&o&&e.jsx("div",{style:{marginTop:"20px",textAlign:"center"},children:e.jsx("p",{children:"As the quiz host, you're seeing the live leaderboard. Participants are seeing the quiz questions."})})]}):e.jsx("div",{className:"auth-container",children:e.jsxs(x,{title:e.jsxs("div",{children:[e.jsx(C,{level:3,children:a.quiz.title||"Quiz Leaderboard"}),e.jsxs(C,{level:5,children:["Quiz Code: ",e.jsx(i,{color:"cyan",children:h}),a.quiz.category&&e.jsx(i,{color:"purple",style:{marginLeft:8},children:a.quiz.category})]}),e.jsx(i,{color:a.quiz.status==="completed"?"green":"blue",children:((v=a.quiz.status)==null?void 0:v.charAt(0).toUpperCase())+((k=a.quiz.status)==null?void 0:k.slice(1))})]}),className:"auth-card",children:[e.jsxs(P,{gutter:16,style:{marginBottom:24},children:[e.jsx(l,{span:8,children:e.jsx(d,{title:"Average Score",value:Math.round(a.metadata.averageScore*10)/10||0,suffix:"points"})}),e.jsx(l,{span:8,children:e.jsx(d,{title:"Highest Score",value:a.metadata.highestScore||0,suffix:"points",valueStyle:{color:"#3f8600"}})}),e.jsx(l,{span:8,children:e.jsx(d,{title:"Total Participants",value:a.quiz.totalParticipants||((z=a.leaderboard)==null?void 0:z.length)||0})})]}),((w=a.leaderboard)==null?void 0:w.length)>0?e.jsx(L,{dataSource:a.leaderboard.map((t,r)=>({...t,rank:r+1,key:t.userId})),columns:f,pagination:!1,loading:m,rowKey:"userId",className:"leaderboard-table"}):e.jsx(p,{status:"info",title:"No Results Yet",subTitle:"The leaderboard is currently empty. Please wait for the quiz to complete."}),e.jsx("div",{style:{marginTop:"20px",textAlign:"center"},children:e.jsx(A,{type:"primary",onClick:()=>j("/home"),size:"large",children:"Back to Home"})})]})})},ee=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}));export{G as L,ee as a,c as s};
